function B(n){return Array.from(new Set(n))}function v(n,e){const t=N();return t[n]=t[n]||e}function N(){const n="_vike";return globalThis[n]=globalThis[n]||{}}const l=new Proxy({},{get:(n,e)=>t=>e==="code"?`\`${t}\``:e==="string"?`'${t}'`:t}),E="0.4.229";let f;f??(f=W());function W(){return v("utils/assertSingleInstance.ts",{instances:[],alreadyLogged:new Set})}function k(){return f??(f=W()),f}const G="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",P="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function R(){const n=k();{const e=B(n.instances);h(e.length<=1,`vike@${l.bold(e[0])} and vike@${l.bold(e[1])} loaded which is highly discouraged, see ${l.underline("https://vike.dev/warning/version-mismatch")}`,{onlyOnce:!0,showStackTrace:!1})}n.checkSingleInstance&&n.instances.length>1&&h(!1,P,{onlyOnce:!0,showStackTrace:!0})}function X(n){const e=k();h(e.isClientRouting!==!1,G,{onlyOnce:!0,showStackTrace:!0}),h(e.isClientRouting===void 0,P,{onlyOnce:!0,showStackTrace:!0}),e.isClientRouting=!0,e.checkSingleInstance=!0,R()}function V(){k().instances.push(E),R()}function h(n,e,{onlyOnce:t,showStackTrace:r}){const i=k();if(n)return;const o=`[Vike][Warning] ${e}`;{const{alreadyLogged:c}=i,u=o;if(c.has(u))return;c.add(u)}console.warn(r?new Error(o):o)}function A(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function p(n,e){const t=new Error(n);return A()&&(t.stack=H(t.stack,e)),t}function H(n,e){if(!n)return n;const t=z(n);let r=0;return t.filter(o=>o.includes(" (internal/")||o.includes(" (node:internal")?!1:r<e&&J(o)?(r++,!1):!0).join(`
`)}function J(n){return n.startsWith("    at ")}function z(n){return n.split(/\r?\n/)}function D(n){return typeof n=="object"&&n!==null}const s=v("utils/assert.ts",{alreadyLogged:new Set,logger(n,e){e==="info"?console.log(n):console.warn(n)},showStackTraceList:new WeakSet});V();const F="[vike]",U=`[vike@${E}]`,q="Bug",b=2;function Z(n,e){var c;if(n)return;const t=(()=>{if(!e)return null;const u=typeof e=="string"?e:JSON.stringify(e);return l.dim(`Debug info (for Vike maintainers; you can ignore this): ${u}`)})();let i=[`You stumbled upon a Vike bug. Go to ${l.underline("https://github.com/vikejs/vike/issues/new?template=bug.yml")} and copy-paste this error. A maintainer will fix the bug (usually within 24 hours).`,t].filter(Boolean).join(" ");i=d(i),i=y(i,q),i=g(i,!0);const o=p(i,b);throw(c=s.onBeforeLog)==null||c.call(s),o}function M(n,e,{showStackTrace:t,exitOnError:r}={}){var o;if(n)return;t=t||s.alwaysShowStackTrace,e=d(e),e=y(e,"Wrong Usage"),e=g(e);const i=p(e,b);if(t&&s.showStackTraceList.add(i),(o=s.onBeforeLog)==null||o.call(s),r)console.error(t?i:e),process.exit(1);else throw i}function K(n){return n=d(n),n=y(n,"Error"),n=g(n),p(n,b)}function Y(n,e,{onlyOnce:t,showStackTrace:r}){var i;if(!n){if(r=r||s.alwaysShowStackTrace,e=d(e),e=y(e,"Warning"),e=g(e),t){const{alreadyLogged:o}=s,c=t===!0?e:t;if(o.has(c))return;o.add(c)}if((i=s.onBeforeLog)==null||i.call(s),r){const o=p(e,b);s.showStackTraceList.add(o),s.logger(o,"warn")}else s.logger(e,"warn")}}function ee(n,e,{onlyOnce:t}){var r;e=d(e),e=g(e);{const{alreadyLogged:i}=s,o=e;if(i.has(o))return;i.add(o)}(r=s.onBeforeLog)==null||r.call(s),s.logger(e,"info")}function y(n,e){let t=`[${e}]`;const r=e==="Warning"?"yellow":"red";return t=l.bold(l[r](t)),`${t}${n}`}function d(n){return n.startsWith("[")?n:` ${n}`}function g(n,e=!1){return`${e?U:F}${n}`}function L(n){const e=n/1e3;if(e<120){const t=O(e);return`${t} second${x(t)}`}{const t=e/60,r=O(t);return`${r} minute${x(r)}`}}function O(n){let e=n.toFixed(1);return e.endsWith(".0")&&(e=e.slice(0,-2)),e}function x(n){return n==="1"?"":"s"}const m=v("utils/executeHook.ts",{userHookErrors:new WeakMap,pageContext:null});function ne(n,e,t){const{hookName:r,hookFilePath:i,hookTimeout:{error:o,warning:c}}=e;let u,w;const _=new Promise((a,I)=>{u=T=>{S(),a(T)},w=T=>{S(),I(T)}}),S=()=>{j&&clearTimeout(j),$&&clearTimeout($)},j=C(c)&&setTimeout(()=>{Y(!1,`The ${r}() hook defined by ${i} is slow: it's taking more than ${L(c)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},c),$=C(o)&&setTimeout(()=>{const a=K(`The ${r}() hook defined by ${i} timed out: it didn't finish after ${L(o)} (https://vike.dev/hooksTimeout)`);w(a)},o);return(async()=>{try{Q(t);const a=await n();u(a)}catch(a){D(a)&&m.userHookErrors.set(a,{hookName:r,hookFilePath:i}),w(a)}})(),_}function C(n){return!!n&&n!==1/0}function Q(n){m.pageContext=n,Promise.resolve().then(()=>{m.pageContext=null})}export{M as a,l as b,Y as c,Z as d,ne as e,K as f,v as g,ee as h,D as i,X as j,Q as p,B as u};
